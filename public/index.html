<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CRUD de Personajes</title>
  </head>
  <body>
    <h1>Agregar Personaje</h1>
    <div>
      <input type="text" id="charName" placeholder="Nombre" />
      <br/><br/>
      <input type="text" id="ability1" placeholder="Habilidad 1" />
      <input type="text" id="ability2" placeholder="Habilidad 2" />
      <input type="text" id="ability3" placeholder="Habilidad 3" />
      <input type="text" id="ability4" placeholder="Habilidad 4" />
      <br/><br/>
      <input type="number" id="charLevel" placeholder="Nivel" />
      <br/><br/>
      <button id="btnAddCharacter">Agregar Personaje</button>
    </div>

    <hr/>

    <h2>Operaciones CRUD (Leer y Eliminar en este ejemplo)</h2>
    <!-- Botón para mostrar personajes -->
    <button id="btnShowCharacters">Mostrar Personajes</button>
    
    <!-- Sección oculta al inicio, donde mostraremos los personajes -->
    <div id="charactersSection" style="display: none;">
      <ul id="charactersList"></ul>
    </div>
    
    <script>

      const API_URL = "https://crud-mongo-rsxf.onrender.com/api/characters";

      /****************************************************
       * 1) AGREGAR PERSONAJE
       ****************************************************/
      document.getElementById('btnAddCharacter').addEventListener('click', async () => {
        const name = document.getElementById('charName').value;
        const ability1 = document.getElementById('ability1').value;
        const ability2 = document.getElementById('ability2').value;
        const ability3 = document.getElementById('ability3').value;
        const ability4 = document.getElementById('ability4').value;
        const level = document.getElementById('charLevel').value;

        // Creamos un arreglo con las 4 habilidades
        const abilities = [ability1, ability2, ability3, ability4];

        // Llamada POST para crear el personaje
        try {
          await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, abilities, level })
          });
        } catch (error) {
          console.error('Error al crear personaje:', error);
        }

        // Limpiamos los campos
        document.getElementById('charName').value = '';
        document.getElementById('ability1').value = '';
        document.getElementById('ability2').value = '';
        document.getElementById('ability3').value = '';
        document.getElementById('ability4').value = '';
        document.getElementById('charLevel').value = '';
      });

      /****************************************************
       * 2) MOSTRAR LISTA DE PERSONAJES Y ELIMINAR
       ****************************************************/
      // Función para obtener personajes y mostrarlos
      async function fetchCharacters() {
        try {
          const res = await fetch(API_URL);
          const characters = await res.json();

          // Limpiamos la lista
          const list = document.getElementById('charactersList');
          list.innerHTML = '';

          // Renderizamos cada personaje
          characters.forEach(character => {
            const li = document.createElement('li');
            li.textContent = `Nombre: ${character.name} | 
                              Habilidades: ${character.abilities.join(', ')} | 
                              Nivel: ${character.level}`;

            // Botón para eliminar
            const btnDelete = document.createElement('button');
            btnDelete.textContent = 'Eliminar';
            btnDelete.onclick = async () => {
              try {
                await fetch(`${API_URL}/${character._id}`, {
                  method: 'DELETE'
                });
                // Vuelve a cargar la lista después de eliminar
                fetchCharacters();
              } catch (error) {
                console.error('Error al eliminar personaje:', error);
              }
            };

            li.appendChild(btnDelete);
            list.appendChild(li);
          });
        } catch (error) {
          console.error('Error al obtener personajes:', error);
        }
      }

      // Botón para mostrar personajes
      const btnShowCharacters = document.getElementById('btnShowCharacters');
      const charactersSection = document.getElementById('charactersSection');

      btnShowCharacters.addEventListener('click', () => {
        // Mostramos la sección (si estaba oculta)
        charactersSection.style.display = 'block';
        // Cargamos la lista de personajes
        fetchCharacters();
      });
    </script>
  </body>
</html>
