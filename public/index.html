<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CRUD con Node y MongoDB Atlas</title>
  </head>
  <body>
    <h1>Lista de Tareas</h1>
    <div>
      <input type="text" id="title" placeholder="Título" />
      <input type="text" id="desc" placeholder="Descripción" />
      <button id="btnAdd">Agregar Tarea</button>
    </div>
    
    <ul id="taskList"></ul>
    
    <script>
      const API_URL = "https://crud-mongo-rsxf.onrender.com/api/tasks"; // Cambia esto cuando lo hospedes

      async function fetchTasks() {
        const res = await fetch(API_URL);
        const tasks = await res.json();
        const taskList = document.getElementById('taskList');
        taskList.innerHTML = ''; 
        tasks.forEach(task => {
          const li = document.createElement('li');
          li.textContent = `${task.title} - ${task.description} - Completada: ${task.completed}`;
          
          // Botones para actualizar/borrar
          const btnUpdate = document.createElement('button');
          btnUpdate.textContent = 'Toggle Completada';
          btnUpdate.onclick = async () => {
            await fetch(`${API_URL}/${task._id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                ...task,
                completed: !task.completed
              })
            });
            fetchTasks();
          };
          
          const btnDelete = document.createElement('button');
          btnDelete.textContent = 'Eliminar';
          btnDelete.onclick = async () => {
            await fetch(`${API_URL}/${task._id}`, {
              method: 'DELETE'
            });
            fetchTasks();
          };

          li.appendChild(btnUpdate);
          li.appendChild(btnDelete);
          taskList.appendChild(li);
        });
      }

      document.getElementById('btnAdd').addEventListener('click', async () => {
        const title = document.getElementById('title').value;
        const description = document.getElementById('desc').value;
        
        // Crea nueva tarea
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, description })
        });
        
        document.getElementById('title').value = '';
        document.getElementById('desc').value = '';
        
        // Refresca la lista de tareas
        fetchTasks();
      });

      // Al cargar la página, obten las tareas
      fetchTasks();
    </script>
  </body>
</html>
